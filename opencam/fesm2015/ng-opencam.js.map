{"version":3,"file":"ng-opencam.js.map","sources":["ng://ng-opencam/lib/opencam.service.ts","ng://ng-opencam/lib/opencam.models.ts","ng://ng-opencam/lib/opencam.component.ts","ng://ng-opencam/lib/opencam.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OpencamService {\n\n  constructor() { }\n}\n","\nexport enum ECaptureType {\n  VIDEO = 'video',\n  PICTURE = 'picture'\n}\n\nexport enum EStreamState {\n  PLAY = 'play',\n  PAUSE = 'pause',\n  STOP = 'stop'\n}\n\nexport interface ISourceDevice {\n  id: string;\n  label: string;\n  kind: string;\n}\n\nexport enum EMediaConstraints {\n  HD = 'hd',\n  VGA = 'vga',\n  FHD = 'fhd',\n  DEFAULT = 'default'\n}\n\n/*\nexport enum EFilter {\n  BLUR = 'blur',\n  BRIGHTNESS = 'brightness',\n  CONTRAST = 'contrast',\n  DROP_SHADOW = 'drop-shadow',\n  GRAYSCALE = 'grayscale',\n  HUE_ROTATE = 'hue-rotate',\n  INVERT = 'invert',\n  OPACITY = 'opacity',\n  SATURATE = 'saturate',\n  SEPIA = 'sepia',\n  NONE = 'none'\n}\n*/\n\n","import { Component, OnInit, Input, Output, EventEmitter, ViewChild, OnDestroy } from '@angular/core';\nimport { ISourceDevice, ECaptureType, EStreamState, EMediaConstraints } from './opencam.models';\nimport { Observable } from 'rxjs';\n\n@Component({\n  selector: 'ng-opencam',\n  templateUrl: './opencam.component.html',\n  styles: []\n})\nexport class OpencamComponent implements OnInit, OnDestroy {\n\n  @Output()\n  captureEvent: EventEmitter<any> = new EventEmitter(true);\n  @Output()\n  videoSourceEvent: EventEmitter<ISourceDevice[]> = new EventEmitter(true);\n  @Output()\n  audioSourceEvent: EventEmitter<ISourceDevice[]> = new EventEmitter(true);\n  @Output()\n  errorEvent: EventEmitter<Error> = new EventEmitter(true);\n\n  @Input()\n  set framerate(v: number) {\n    if (v > 0 && v <= 60) {\n      this._framerate = Math.abs(v);\n    }\n  }\n  // tslint:disable-next-line:variable-name\n  private _framerate = 30;\n\n  @Input()\n  set videoSource(v: ISourceDevice) {\n    if (this.isScanCompleted) {\n      if (v) {\n        this._videoSource = v;\n        this.stopStream();\n        this.initStream();\n      }\n    }\n  }\n  // tslint:disable-next-line:variable-name\n  private _videoSource: ISourceDevice;\n  @Input()\n  set audioSource(v: ISourceDevice) {\n    if (this.isScanCompleted) {\n      this._audioSource = v;\n      this.stopStream();\n      this.initStream();\n    }\n  }\n  // tslint:disable-next-line:variable-name\n  private _audioSource: ISourceDevice = null;\n  display: string;\n  @Input()\n  set width(v: string) {\n    if (v !== null) {\n      this._width = v;\n    } else {\n      this.display = 'none';\n    }\n  }\n  // tslint:disable-next-line:variable-name\n  _width: string;\n  @Input()\n  set height(v: string) {\n    if (v !== null) {\n      this._height = v;\n    } else {\n      this.display = 'none';\n    }\n  }\n  // tslint:disable-next-line:variable-name\n  _height: string;\n  @Input()\n  set capture(v: Observable<number>) {\n    v.subscribe(\n      (c) => {\n        setTimeout(() => {\n          if (this.stream) {\n            if (this._captureType === ECaptureType.VIDEO) {\n              if (!this.isRecording) {\n                this.startRecording();\n              } else {\n                this.stopRecording();\n              }\n            } else {\n              const img = this.captureStreamShot();\n              if (img) { this.captureHandler(img); }\n            }\n          }\n        }, 1000 * Math.abs(c));\n      }\n    );\n  }\n  // tslint:disable-next-line:variable-name\n  private _capture: Observable<number>;\n  @Input()\n  set captureType(v: ECaptureType) {\n    this._captureType = v;\n  }\n  // tslint:disable-next-line:variable-name\n  private _captureType: ECaptureType;\n  @Input()\n  set streamState(v: EStreamState) {\n    if (v) {\n      this._streamState = v;\n      if (this.stream !== undefined && this.stream !== null) {\n        if (v === EStreamState.PLAY) {\n          this.video.play();\n          if (this.recorder) {\n            this.recorder.resume();\n          }\n        } else if (v === EStreamState.PAUSE) {\n          this.video.pause();\n          if (this.recorder) {\n            this.recorder.pause();\n          }\n        } else if (v === EStreamState.STOP) {\n          this.video.pause();\n          if (this.recorder) {\n            this.recorder.stop();\n          }\n          this.stopStream();\n          this.video.srcObject = null;\n        }\n      } else {\n        if (v === EStreamState.PLAY && this.videoSources.length > 0) {\n          this.initStream();\n        }\n      }\n    }\n  }\n  // tslint:disable-next-line:variable-name\n  private _streamState: EStreamState;\n  @Input()\n  set mediaConstraints(v: EMediaConstraints) {\n    if (v) {\n      this._mediaConstraints = v;\n      if (v === EMediaConstraints.HD) {\n        this.constraints.video.width = {min: 1280};\n        this.constraints.video.height = {min: 720};\n      } else if (v === EMediaConstraints.FHD) {\n        this.constraints.video.width = {min: 1920};\n        this.constraints.video.height = {min: 1080};\n      } else if (v === EMediaConstraints.VGA) {\n        this.constraints.video.width = {min: 640};\n        this.constraints.video.height = {min: 480};\n      } else {\n        if (this.constraints && this.constraints.video) {\n          if (this.constraints.video.width) {\n            delete this.constraints.video.width;\n          }\n          if (this.constraints.video.height) {\n            delete this.constraints.video.height;\n          }\n        }\n\n      }\n      if (this.stream && this.stopStream()) {\n        this.initStream();\n      }\n    }\n  }\n  // tslint:disable-next-line:variable-name\n  private _mediaConstraints: EMediaConstraints;\n  @Input()\n  set filters(v: string) {\n    this._filters = v;\n    if (this.ctx) {\n      this.ctx.filter = v;\n    }\n  }\n  // tslint:disable-next-line:variable-name\n  private _filters: string;\n\n  video = document.createElement('video');\n  @ViewChild('opencam', {static: true})\n  canvas;\n  ctx: CanvasRenderingContext2D;\n\n  private videoSources: ISourceDevice[] = [];\n  private audioSources: ISourceDevice[] = [];\n\n  private currentVideoSource: ISourceDevice;\n  private currentAudioSource: ISourceDevice;\n\n  private rafId;\n  private stream;\n  private constraints: any = {\n    audio: {},\n    video: {}\n  };\n\n  isStreamLoading: boolean;\n  isStreamInProgress: boolean;\n  isRecording: boolean;\n  isScanCompleted: boolean;\n  recorder;\n\n  frames: string[];\n\n  constructor() {}\n\n  ngOnInit() {\n    this.ctx = this.canvas.nativeElement.getContext('2d');\n    const sizeWidth = this.ctx.canvas.clientWidth;\n    const sizeHeight = this.ctx.canvas.clientHeight;\n    this.canvas.width = sizeWidth;\n    this.canvas.height = sizeHeight;\n    this.isScanCompleted = false;\n    this.initOpenCam();\n  }\n\n  initOpenCam() {\n    navigator.mediaDevices\n      .ondevicechange = (e) => this.scanCaptureDevices();\n    this.scanCaptureDevices();\n  }\n\n  scanCaptureDevices() {\n    navigator.mediaDevices\n      .enumerateDevices()\n      .then((d: MediaDeviceInfo[]) => { this.handleCaptureDevices(d); /*this.initStream();*/ })\n      .catch((e) => this.errorHandler(e));\n  }\n\n  sourceHandler() {\n    this.videoSourceEvent.emit(this.videoSources);\n    this.audioSourceEvent.emit(this.audioSources);\n  }\n\n  captureHandler(c) {\n    this.captureEvent.emit(c);\n  }\n\n  errorHandler(e) {\n    this.errorEvent.emit(e);\n  }\n\n  private handleCaptureDevices(devicesInfos: MediaDeviceInfo[]) {\n      let devicesFound = 0;\n      this.videoSources = [];\n      this.audioSources = [];\n        // tslint:disable-next-line:prefer-for-of\n      for (let i = 0; i < devicesInfos.length; i++) {\n            if (devicesInfos[i].kind === 'videoinput') {\n              if(devicesInfos[i].deviceId !== undefined) {\n                devicesFound++;\n                this.videoSources.push({\n                  id: devicesInfos[i].deviceId,\n                  label: devicesInfos[i].label,\n                  kind: devicesInfos[i].kind,\n                });\n              }\n            }\n            if (devicesInfos[i].kind === 'audioinput') {\n              if(devicesInfos[i].deviceId !== undefined) {\n                this.audioSources.push({\n                  id: devicesInfos[i].deviceId,\n                  label: devicesInfos[i].label,\n                  kind: devicesInfos[i].kind,\n                });\n              }\n            }\n      }\n      if (devicesFound === 0) {\n        const e = new Error();\n        e.name = 'No devices available';\n        e.message = 'Useful devices not found during scan';\n        this.errorHandler(e);\n      } else {\n        // emit devices\n        this.sourceHandler();\n      }\n      this.isScanCompleted = true;\n  }\n\n  private initStream() {\n    if (this.videoSources.length > 0) {\n\n      if (!this._videoSource) {\n        this.currentVideoSource = this.videoSources[0];\n      } else {\n        this.currentVideoSource = this._videoSource;\n      }\n\n      if (!this._audioSource) {\n        this.currentAudioSource = null;\n        this.constraints.audio = false;\n      } else {\n        this.currentAudioSource = this._audioSource as ISourceDevice;\n        this.constraints.audio = { deviceId: { exact: this.currentAudioSource.id }};\n      }\n\n      this.constraints.video.deviceId = { exact: this.currentVideoSource.id };\n\n      navigator.mediaDevices.getUserMedia(this.constraints)\n      .then( (stream) => {\n            this.video.addEventListener('loadedmetadata', () => {\n              this.canvas.clientWidth = this.video.videoWidth;\n              this.canvas.clientHeight = this.video.videoHeight;\n            });\n            this.video.addEventListener('play', () => this.drawToCanvas());\n            this.stream = stream;\n            this.video.srcObject = this.stream;\n            this.video.muted = true;\n            this.video.controls = false;\n            if(this._streamState === EStreamState.PLAY) {\n              this.video.play();\n            }\n        }).catch( (error) => {\n          this.errorHandler(error);\n        });\n\n    } else {\n      const e = new Error();\n      e.name = 'Video stream init failed';\n      e.message = 'No devices available for stream';\n      this.errorHandler(e);\n    }\n  }\n\n  getAudioStream() {\n    const audioCtx = new AudioContext();\n    const source = audioCtx.createMediaStreamSource(this.stream);\n    const destination = audioCtx.createMediaStreamDestination();\n    source.connect(destination);\n    source.connect(audioCtx.destination);\n    const audioStream = destination.stream;\n    return audioStream;\n  }\n\n  private startRecording() {\n    this.isRecording = true;\n    // frames recorded only on re-renders\n    // @ts-ignore\n    const videoStream = this.canvas.nativeElement.captureStream(this._framerate);\n    // const audioStream = this.getAudioStream();\n    let stream;\n    if (this._audioSource) {\n      stream = new MediaStream([\n        ...this.stream.getAudioTracks(),\n        ...videoStream.getTracks()\n      ]);\n    } else {\n      stream = videoStream;\n    }\n    // @ts-ignore\n    this.recorder = new MediaRecorder(stream);\n    this.frames = [];\n    this.recorder.ondataavailable = (e) => this.extractRecording(e);\n    this.recorder.start();\n  }\n\n  extractRecording(e) {\n    this.frames.push(e.data);\n    const webmBlob = new Blob(this.frames, { type: 'video/webm' });\n    const downloadUrl = URL.createObjectURL(webmBlob);\n    this.captureHandler(downloadUrl);\n    this.recorder = null;\n  }\n\n  private stopRecording() {\n    this.recorder.stop();\n    this.isRecording = false;\n  }\n\n  private drawToCanvas() {\n    this.ctx.drawImage(this.video, 0, 0);\n    setTimeout(() => this.drawToCanvas(), (1000 / this._framerate));\n  }\n\n  private captureStreamShot() {\n    if (this.video) {\n      const canvas = document.createElement('canvas');\n      canvas.width = this.video.videoWidth;\n      canvas.height = this.video.videoHeight;\n      canvas.getContext('2d').drawImage(this.canvas.nativeElement, 0, 0);\n      const data = canvas.toDataURL();\n      return data;\n    }\n  }\n\n  stopStream() {\n    if (this.stream) {\n      this.stream.getTracks().forEach(\n        (track) => {\n        track.stop();\n      });\n    }\n    this.stream = null;\n    return true;\n  }\n\n  ngOnDestroy(): void {\n    this.stopStream();\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { OpencamComponent } from './opencam.component';\n\n@NgModule({\n  declarations: [OpencamComponent],\n  imports: [\n  ],\n  exports: [OpencamComponent]\n})\nexport class OpencamModule { }\n"],"names":[],"mappings":"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"}
